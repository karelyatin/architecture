---
vas:
  uni01alpha:
    stages:
      - path: examples/dt/uni01alpha/control-plane/nncp
        wait_conditions:
          - >-
            oc -n openstack wait nncp
            -l osp/nncm-config-type=standard
            --for jsonpath='{.status.conditions[0].reason}'=SuccessfullyConfigured
            --timeout=60s
        values:
          - name: network-values
            src_file: values.yaml
        build_output: nncp.yaml

      - pre_stage_run:
          - name: Apply cinder-lvm label on master-0
            type: cr
            definition:
              metadata:
                labels:
                  openstack.org/cinder-lvm: ""
            kind: Node
            resource_name: master-0
            state: patched
        path: examples/dt/uni01alpha/control-plane
        wait_conditions:
          - >-
            oc -n openstack wait openstackcontrolplane
            controlplane
            --for condition=Ready
            --timeout=30m
        values:
          - name: network-values
            src_file: nncp/values.yaml
          - name: service-values
            src_file: service-values.yaml
        build_output: control-plane.yaml

      - pre_stage_run:
          - name: Replace resource links with files from library.
            type: playbook
            source: "../../hooks/playbooks/link2file.yml"
            extra_vars:
              # yamllint disable rule:line-length
              cifmw_link2file_files: "dt/uni01alpha/networker/dataplane-ssh-secret.yaml,dt/uni01alpha/networker/openstackdataplanenodeset.yaml,dt/uni01alpha/networker/openstackdataplanedeployment.yaml"
        path: examples/dt/uni01alpha/networker
        wait_conditions:
          - >-
            oc -n openstack wait openstackdataplanedeployment
            networker-deploy
            --for condition=Ready
            --timeout=1200s
        values:
          - name: edpm-networker-values
            src_file: values.yaml
        build_output: edpm-networker.yaml

      - path: examples/dt/uni01alpha
        wait_conditions:
          - >-
            oc -n openstack wait openstackdataplanedeployment
            edpm-deployment
            --for condition=Ready
            --timeout=1200s
        values:
          - name: edpm-values
            src_file: values.yaml
        build_output: edpm.yaml
